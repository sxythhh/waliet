{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/waliet/lib/supabase/middleware.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\";\nimport { NextResponse, type NextRequest } from \"next/server\";\n\nexport async function updateSupabaseSession(request: NextRequest) {\n  // Skip if Supabase is not configured\n  if (!process.env.NEXT_PUBLIC_SUPABASE_URL || !process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY) {\n    return NextResponse.next({ request });\n  }\n\n  let supabaseResponse = NextResponse.next({ request });\n\n  const supabase = createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,\n    {\n      cookies: {\n        getAll() {\n          return request.cookies.getAll();\n        },\n        setAll(cookiesToSet) {\n          cookiesToSet.forEach(({ name, value }) =>\n            request.cookies.set(name, value)\n          );\n          supabaseResponse = NextResponse.next({ request });\n          cookiesToSet.forEach(({ name, value, options }) =>\n            supabaseResponse.cookies.set(name, value, options)\n          );\n        },\n      },\n    }\n  );\n\n  // Refresh session if it exists\n  await supabase.auth.getUser();\n\n  return supabaseResponse;\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;AAAA;;;AAEO,eAAe,sBAAsB,OAAoB;IAC9D,qCAAqC;IACrC;;IAIA,IAAI,mBAAmB,0MAAY,CAAC,IAAI,CAAC;QAAE;IAAQ;IAEnD,MAAM,WAAW,IAAA,iNAAkB,sUAGjC;QACE,SAAS;YACP;gBACE,OAAO,QAAQ,OAAO,CAAC,MAAM;YAC/B;YACA,QAAO,YAAY;gBACjB,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,GACnC,QAAQ,OAAO,CAAC,GAAG,CAAC,MAAM;gBAE5B,mBAAmB,0MAAY,CAAC,IAAI,CAAC;oBAAE;gBAAQ;gBAC/C,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,iBAAiB,OAAO,CAAC,GAAG,CAAC,MAAM,OAAO;YAE9C;QACF;IACF;IAGF,+BAA+B;IAC/B,MAAM,SAAS,IAAI,CAAC,OAAO;IAE3B,OAAO;AACT"}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/waliet/middleware.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport type { NextRequest } from \"next/server\";\nimport { updateSupabaseSession } from \"@/lib/supabase/middleware\";\n\nexport async function middleware(request: NextRequest) {\n  // Get Whop token from various sources\n  const devToken = request.nextUrl.searchParams.get(\"whop-dev-user-token\");\n  const headerToken = request.headers.get(\"x-whop-user-token\");\n  const cookieToken = request.cookies.get(\"whop-dev-user-token\")?.value;\n\n  const whopToken = headerToken || devToken || cookieToken;\n\n  // Check for Supabase session\n  const hasSupabaseSession = request.cookies.getAll().some(\n    (cookie) => cookie.name.startsWith(\"sb-\") && cookie.name.includes(\"-auth-token\")\n  );\n\n  // If we have a dev token in URL, set cookie for future requests\n  if (devToken) {\n    const requestHeaders = new Headers(request.headers);\n    requestHeaders.set(\"x-whop-user-token\", devToken);\n\n    const response = NextResponse.next({\n      request: { headers: requestHeaders },\n    });\n\n    // Also set cookie for future requests without the URL param\n    response.cookies.set(\"whop-dev-user-token\", devToken, {\n      httpOnly: true,\n      secure: process.env.NODE_ENV === \"production\",\n      sameSite: \"lax\",\n      maxAge: 60 * 60 * 24, // 24 hours\n    });\n\n    return response;\n  }\n\n  // If we have Whop token from cookie but not header, add to headers\n  if (cookieToken && !headerToken) {\n    const requestHeaders = new Headers(request.headers);\n    requestHeaders.set(\"x-whop-user-token\", cookieToken);\n\n    // Also update Supabase session\n    const supabaseResponse = await updateSupabaseSession(request);\n\n    // Merge headers\n    const response = NextResponse.next({\n      request: { headers: requestHeaders },\n    });\n\n    // Copy Supabase cookies to response\n    supabaseResponse.cookies.getAll().forEach((cookie) => {\n      response.cookies.set(cookie.name, cookie.value);\n    });\n\n    return response;\n  }\n\n  // For API routes, check authentication\n  if (request.nextUrl.pathname.startsWith(\"/api/\")) {\n    // Allow these routes without auth\n    if (\n      request.nextUrl.pathname.startsWith(\"/api/webhooks/\") ||\n      request.nextUrl.pathname.startsWith(\"/api/auth/\") ||\n      request.nextUrl.pathname === \"/api/health\"\n    ) {\n      return updateSupabaseSession(request);\n    }\n\n    // Require either Whop token or Supabase session for other API routes\n    if (!whopToken && !hasSupabaseSession) {\n      return NextResponse.json(\n        { error: \"Authentication required\" },\n        { status: 401 }\n      );\n    }\n  }\n\n  // Update Supabase session for all other requests\n  return updateSupabaseSession(request);\n}\n\nexport const config = {\n  matcher: [\"/((?!_next/static|_next/image|favicon.ico).*)\"],\n};\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;;;AAEO,eAAe,WAAW,OAAoB;IACnD,sCAAsC;IACtC,MAAM,WAAW,QAAQ,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC;IAClD,MAAM,cAAc,QAAQ,OAAO,CAAC,GAAG,CAAC;IACxC,MAAM,cAAc,QAAQ,OAAO,CAAC,GAAG,CAAC,wBAAwB;IAEhE,MAAM,YAAY,eAAe,YAAY;IAE7C,6BAA6B;IAC7B,MAAM,qBAAqB,QAAQ,OAAO,CAAC,MAAM,GAAG,IAAI,CACtD,CAAC,SAAW,OAAO,IAAI,CAAC,UAAU,CAAC,UAAU,OAAO,IAAI,CAAC,QAAQ,CAAC;IAGpE,gEAAgE;IAChE,IAAI,UAAU;QACZ,MAAM,iBAAiB,IAAI,QAAQ,QAAQ,OAAO;QAClD,eAAe,GAAG,CAAC,qBAAqB;QAExC,MAAM,WAAW,0MAAY,CAAC,IAAI,CAAC;YACjC,SAAS;gBAAE,SAAS;YAAe;QACrC;QAEA,4DAA4D;QAC5D,SAAS,OAAO,CAAC,GAAG,CAAC,uBAAuB,UAAU;YACpD,UAAU;YACV,QAAQ,oDAAyB;YACjC,UAAU;YACV,QAAQ,KAAK,KAAK;QACpB;QAEA,OAAO;IACT;IAEA,mEAAmE;IACnE,IAAI,eAAe,CAAC,aAAa;QAC/B,MAAM,iBAAiB,IAAI,QAAQ,QAAQ,OAAO;QAClD,eAAe,GAAG,CAAC,qBAAqB;QAExC,+BAA+B;QAC/B,MAAM,mBAAmB,MAAM,IAAA,wKAAqB,EAAC;QAErD,gBAAgB;QAChB,MAAM,WAAW,0MAAY,CAAC,IAAI,CAAC;YACjC,SAAS;gBAAE,SAAS;YAAe;QACrC;QAEA,oCAAoC;QACpC,iBAAiB,OAAO,CAAC,MAAM,GAAG,OAAO,CAAC,CAAC;YACzC,SAAS,OAAO,CAAC,GAAG,CAAC,OAAO,IAAI,EAAE,OAAO,KAAK;QAChD;QAEA,OAAO;IACT;IAEA,uCAAuC;IACvC,IAAI,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,UAAU;QAChD,kCAAkC;QAClC,IACE,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,qBACpC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,iBACpC,QAAQ,OAAO,CAAC,QAAQ,KAAK,eAC7B;YACA,OAAO,IAAA,wKAAqB,EAAC;QAC/B;QAEA,qEAAqE;QACrE,IAAI,CAAC,aAAa,CAAC,oBAAoB;YACrC,OAAO,0MAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA0B,GACnC;gBAAE,QAAQ;YAAI;QAElB;IACF;IAEA,iDAAiD;IACjD,OAAO,IAAA,wKAAqB,EAAC;AAC/B;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;KAAgD;AAC5D"}}]
}