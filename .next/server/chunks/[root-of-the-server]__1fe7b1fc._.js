module.exports=[57161,(e,a,t)=>{a.exports=e.x("@prisma/client-5551ed320f9fac8d",()=>require("@prisma/client-5551ed320f9fac8d"))},54969,e=>e.a(async(a,t)=>{try{let a=await e.y("pg-0af994d0a334f027");e.n(a),t()}catch(e){t(e)}},!0),93695,(e,a,t)=>{a.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},18622,(e,a,t)=>{a.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,a,t)=>{a.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,a,t)=>{a.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,a,t)=>{a.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,a,t)=>{a.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},77982,e=>e.a(async(a,t)=>{try{var r=e.i(5179),i=e.i(61756),s=e.i(83974),l=e.i(52613),n=a([l]);async function o(){let e=await u();if(e){console.log("[DualAuth] Authenticated via Whop:",e.userId);let a=await c(e);return{user:{id:a.id,name:e.name,email:e.email||null,avatar:e.profilePicUrl||null,provider:"whop",providerId:e.userId},dbUser:a}}let a=await d();if(a){console.log("[DualAuth] Authenticated via Supabase:",a.id);let e=await p(a);return{user:{id:e.id,name:a.name,email:a.email,avatar:a.avatar,provider:"supabase",providerId:a.id},dbUser:e}}return console.log("[DualAuth] No authentication found"),null}async function u(){try{let e=(await (0,r.cookies)()).get("waliet-logged-out"),a=e?.value==="true";if(console.log("[DualAuth] waliet-logged-out cookie:",e?.value,"| loggedOut:",a),a)return console.log("[DualAuth] User logged out, skipping Whop auth"),null;let t=await (0,r.headers)();if(!t.get("x-whop-user-token"))return null;let i=await s.whopsdk.verifyUserToken(t),l=await s.whopsdk.users.retrieve(i.userId);return{userId:i.userId,name:l.name,username:l.username,email:l.email,profilePicUrl:l.profile_picture?.url||void 0}}catch{return null}}async function d(){try{let e=await (0,i.createClient)(),{data:{user:a},error:t}=await e.auth.getUser();if(console.log("[DualAuth] Supabase auth check - user:",a?.id,"error:",t?.message),t||!a)return null;return{id:a.id,email:a.email||"",name:a.user_metadata?.full_name||a.user_metadata?.name||null,avatar:a.user_metadata?.avatar_url||a.user_metadata?.picture||null}}catch(e){return console.log("[DualAuth] Supabase auth error:",e),null}}async function c(e){let a=await l.prisma.user.upsert({where:{whopUserId:e.userId},update:{name:e.name,avatar:e.profilePicUrl||null,email:e.email||void 0},create:{whopUserId:e.userId,name:e.name,avatar:e.profilePicUrl||null,email:e.email||null},include:{sellerProfile:{select:{id:!0,hourlyRate:!0,bio:!0,tagline:!0,averageRating:!0,totalSessionsCompleted:!0,totalReviews:!0,isVerified:!0,isActive:!0}}}});return a.sellerProfile?a:(await l.prisma.sellerProfile.create({data:{userId:a.id,hourlyRate:0,isActive:!0}}),l.prisma.user.findUniqueOrThrow({where:{id:a.id},include:{sellerProfile:{select:{id:!0,hourlyRate:!0,bio:!0,tagline:!0,averageRating:!0,totalSessionsCompleted:!0,totalReviews:!0,isVerified:!0,isActive:!0}}}}))}async function p(e){let a=await l.prisma.user.findUnique({where:{supabaseUserId:e.id},include:{sellerProfile:{select:{id:!0,hourlyRate:!0,bio:!0,tagline:!0,averageRating:!0,totalSessionsCompleted:!0,totalReviews:!0,isVerified:!0,isActive:!0}}}});if(a){let t=await l.prisma.user.update({where:{id:a.id},data:{name:e.name||a.name,avatar:e.avatar||a.avatar,email:e.email||a.email},include:{sellerProfile:{select:{id:!0,hourlyRate:!0,bio:!0,tagline:!0,averageRating:!0,totalSessionsCompleted:!0,totalReviews:!0,isVerified:!0,isActive:!0}}}});return t.sellerProfile?t:(await l.prisma.sellerProfile.create({data:{userId:t.id,hourlyRate:0,isActive:!0}}),l.prisma.user.findUniqueOrThrow({where:{id:t.id},include:{sellerProfile:{select:{id:!0,hourlyRate:!0,bio:!0,tagline:!0,averageRating:!0,totalSessionsCompleted:!0,totalReviews:!0,isVerified:!0,isActive:!0}}}}))}let t=await l.prisma.user.create({data:{supabaseUserId:e.id,name:e.name,avatar:e.avatar,email:e.email}});return await l.prisma.sellerProfile.create({data:{userId:t.id,hourlyRate:0,isActive:!0}}),l.prisma.user.findUniqueOrThrow({where:{id:t.id},include:{sellerProfile:{select:{id:!0,hourlyRate:!0,bio:!0,tagline:!0,averageRating:!0,totalSessionsCompleted:!0,totalReviews:!0,isVerified:!0,isActive:!0}}}})}[l]=n.then?(await n)():n,e.s(["getDualAuthUser",()=>o]),t()}catch(e){t(e)}},!1),12059,73903,7899,e=>{"use strict";let a=Symbol.for("constructDateFrom");function t(e,t){return"function"==typeof e?e(t):e&&"object"==typeof e&&a in e?e[a](t):e instanceof Date?new e.constructor(t):new Date(t)}function r(e,a){return t(a||e,e)}e.s(["constructFromSymbol",0,a,"minutesInDay",0,1440,"minutesInMonth",0,43200],73903),e.s(["constructFrom",()=>t],12059),e.s(["toDate",()=>r],7899)},95868,e=>{"use strict";var a=e.i(12059),t=e.i(7899);function r(e,r,i){var s;let l;return s=-r,l=(0,t.toDate)(e,i?.in),isNaN(s)?(0,a.constructFrom)(i?.in||e,NaN):(s&&l.setDate(l.getDate()+s),l)}e.s(["subDays",()=>r],95868)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__1fe7b1fc._.js.map