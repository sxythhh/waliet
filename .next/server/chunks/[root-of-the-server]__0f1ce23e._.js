module.exports=[57161,(e,t,r)=>{t.exports=e.x("@prisma/client-5551ed320f9fac8d",()=>require("@prisma/client-5551ed320f9fac8d"))},54969,e=>e.a(async(t,r)=>{try{let t=await e.y("pg-0af994d0a334f027");e.n(t),r()}catch(e){r(e)}},!0),93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},43770,e=>e.a(async(t,r)=>{try{e.i(5179);var a=e.i(83974),n=e.i(52613),s=t([n]);async function i(e,t){try{let r=await a.whopsdk.users.checkAccess(e,{id:t});return"admin"===r.access_level}catch{return!1}}async function o(e){let t=await n.prisma.user.findUnique({where:{whopUserId:e},include:{sellerProfile:!0}});if(t)return t;let r=await a.whopsdk.users.retrieve(e);return await n.prisma.user.create({data:{whopUserId:e,email:r.email??null,name:r.name,avatar:r.profile_picture?.url??null},include:{sellerProfile:!0}})}[n]=s.then?(await s)():s,e.s(["checkCompanyAdmin",()=>i,"getOrCreateUser",()=>o]),r()}catch(e){r(e)}},!1),91724,e=>{"use strict";var t=e.i(12230);let r=t.z.object({hourlyRate:t.z.number().min(1).max(1e4),bio:t.z.string().max(500).optional(),tagline:t.z.string().max(100).optional(),timezone:t.z.string().optional()});t.z.object({hourlyRate:t.z.number().min(1).max(1e4)});let a=t.z.object({experienceId:t.z.string().optional(),companyId:t.z.string().optional(),minRating:t.z.coerce.number().min(1).max(5).optional(),maxRate:t.z.coerce.number().optional(),cursor:t.z.string().optional(),limit:t.z.coerce.number().min(1).max(50).default(20),sort:t.z.enum(["rating","sessions","rate_asc","rate_desc","newest"]).default("rating")}),n=t.z.object({sellerId:t.z.string(),units:t.z.number().int().min(1).max(20),experienceId:t.z.string().optional(),companyId:t.z.string().optional()}),s=t.z.object({sellerId:t.z.string(),units:t.z.number().int().min(1).max(4),topic:t.z.string().min(20).max(500),proposedTimes:t.z.array(t.z.string().datetime()).min(1).max(5),timezone:t.z.string()}),i=t.z.object({scheduledAt:t.z.string().datetime()}),o=t.z.object({actualMinutes:t.z.number().int().min(1)}),l=t.z.object({reason:t.z.string().max(500).optional()});t.z.object({role:t.z.enum(["buyer","seller"]).optional(),status:t.z.string().optional(),cursor:t.z.string().optional(),limit:t.z.coerce.number().min(1).max(50).default(20)}),t.z.object({reason:t.z.string().min(20).max(1e3)}),t.z.object({action:t.z.enum(["approve","deny"]),amountApproved:t.z.number().int().min(0).optional(),reviewNotes:t.z.string().max(1e3).optional()}),t.z.object({rating:t.z.number().int().min(1).max(5),text:t.z.string().max(1e3).optional(),isAnonymous:t.z.boolean().optional()}),t.z.object({communityFeeBps:t.z.number().int().min(0).max(5e3).optional(),minSellerRating:t.z.number().min(1).max(5).optional().nullable(),requireApproval:t.z.boolean().optional()}),t.z.object({purchaseId:t.z.string().optional(),sessionId:t.z.string().optional(),reason:t.z.string().min(10).max(1e3),amountRequested:t.z.number().int().min(1)}),e.s(["acceptSessionSchema",0,i,"cancelSessionSchema",0,l,"createPurchaseSchema",0,n,"createSellerSchema",0,r,"createSessionSchema",0,s,"endSessionSchema",0,o,"sellerQuerySchema",0,a])},25083,e=>e.a(async(t,r)=>{try{var a=e.i(39660),n=e.i(52613),s=e.i(83974),i=e.i(43770),o=e.i(91724),l=t([n,i]);async function u(e){try{let{userId:t}=await s.whopsdk.verifyUserToken(e.headers),r=await (0,i.getOrCreateUser)(t);if(!r)return a.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:o}=new URL(e.url),l=o.get("role"),u=o.get("status"),d={};"buyer"===l?d.buyerId=r.id:"seller"===l?d.sellerId=r.id:d.OR=[{buyerId:r.id},{sellerId:r.id}],u&&(d.status=u);let c=await n.prisma.session.findMany({where:d,include:{buyer:{select:{id:!0,name:!0,avatar:!0,whopUserId:!0}},seller:{select:{id:!0,name:!0,avatar:!0,whopUserId:!0,sellerProfile:{select:{hourlyRate:!0,averageRating:!0}}}},review:!0},orderBy:{createdAt:"desc"}});return a.NextResponse.json({sessions:c})}catch(e){return console.error("Error fetching sessions:",e),a.NextResponse.json({error:"Failed to fetch sessions"},{status:500})}}async function d(e){try{let{userId:t}=await s.whopsdk.verifyUserToken(e.headers),r=await e.json(),{sellerId:l,units:u,topic:d,proposedTimes:c,timezone:p}=o.createSessionSchema.parse(r),m=await (0,i.getOrCreateUser)(t);if(!m)return a.NextResponse.json({error:"Failed to get or create user"},{status:500});if(m.id===l)return a.NextResponse.json({error:"Cannot book a session with yourself"},{status:400});let h=await n.prisma.user.findUnique({where:{id:l},include:{sellerProfile:!0}});if(!h||!h.sellerProfile)return a.NextResponse.json({error:"Seller not found"},{status:404});if(!h.sellerProfile.isActive)return a.NextResponse.json({error:"Seller is not accepting bookings"},{status:400});let x=await n.prisma.walletBalance.findUnique({where:{holderId_sellerId:{holderId:m.id,sellerId:l}}});if(!x)return a.NextResponse.json({error:"No hours purchased with this seller"},{status:400});let g=x.balanceUnits-x.reservedUnits;if(g<u)return a.NextResponse.json({error:"Insufficient hours",available:g,requested:u},{status:400});let f=Math.round(h.sellerProfile.hourlyRate/2),w=await n.prisma.$transaction(async e=>(await e.walletBalance.update({where:{holderId_sellerId:{holderId:m.id,sellerId:l}},data:{reservedUnits:{increment:u}}}),await e.session.create({data:{buyerId:m.id,sellerId:l,units:u,topic:d,timezone:p,pricePerUnit:f,status:"REQUESTED",scheduledAt:c[0]?new Date(c[0]):null,scheduledEndAt:c[0]?new Date(new Date(c[0]).getTime()+30*u*6e4):null},include:{buyer:{select:{id:!0,name:!0,avatar:!0}},seller:{select:{id:!0,name:!0,avatar:!0,sellerProfile:{select:{hourlyRate:!0}}}}}})));return a.NextResponse.json({session:w},{status:201})}catch(e){if(console.error("Error creating session:",e),e instanceof Error&&e.message.includes("Zod"))return a.NextResponse.json({error:"Invalid request data"},{status:400});return a.NextResponse.json({error:"Failed to create session"},{status:500})}}[n,i]=l.then?(await l)():l,e.s(["GET",()=>u,"POST",()=>d]),r()}catch(e){r(e)}},!1),81754,e=>e.a(async(t,r)=>{try{var a=e.i(13348),n=e.i(41275),s=e.i(34648),i=e.i(75319),o=e.i(32964),l=e.i(43172),u=e.i(49870),d=e.i(70891),c=e.i(98634),p=e.i(23259),m=e.i(39185),h=e.i(34505),x=e.i(19549),g=e.i(52060),f=e.i(84024),w=e.i(93695);e.i(42630);var R=e.i(4945),y=e.i(25083),v=t([y]);[y]=v.then?(await v)():v;let E=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/sessions/route",pathname:"/api/sessions",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/waliet/app/api/sessions/route.ts",nextConfigOutput:"",userland:y}),{workAsyncStorage:j,workUnitAsyncStorage:C,serverHooks:I}=E;function b(){return(0,s.patchFetch)({workAsyncStorage:j,workUnitAsyncStorage:C})}async function z(e,t,r){E.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/sessions/route";a=a.replace(/\/index$/,"")||"/";let s=await E.prepare(e,t,{srcPage:a,multiZoneDraftMode:!1});if(!s)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:y,params:v,nextConfig:b,parsedUrl:z,isDraftMode:j,prerenderManifest:C,routerServerContext:I,isOnDemandRevalidate:A,revalidateOnlyGenerated:S,resolvedPathname:N,clientReferenceManifest:P,serverActionsManifest:U}=s,k=(0,u.normalizeAppPath)(a),T=!!(C.dynamicRoutes[k]||C.routes[N]),q=async()=>((null==I?void 0:I.render404)?await I.render404(e,t,z,!1):t.end("This page could not be found"),null);if(T&&!j){let e=!!C.routes[N],t=C.dynamicRoutes[k];if(t&&!1===t.fallback&&!e){if(b.experimental.adapterPath)return await q();throw new w.NoFallbackError}}let O=null;!T||E.isDev||j||(O=N,O="/index"===O?"/":O);let _=!0===E.isDev||!T,D=T&&!_;U&&P&&(0,l.setManifestsSingleton)({page:a,clientReferenceManifest:P,serverActionsManifest:U});let H=e.method||"GET",M=(0,o.getTracer)(),F=M.getActiveScopeSpan(),$={params:v,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:_,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,n)=>E.onRequestError(e,t,a,n,I)},sharedContext:{buildId:y}},B=new d.NodeNextRequest(e),K=new d.NodeNextResponse(t),L=c.NextRequestAdapter.fromNodeNextRequest(B,(0,c.signalFromNodeResponse)(t));try{let s=async e=>E.handle(L,$).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=M.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${H} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${a}`)}),l=!!(0,i.getRequestMeta)(e,"minimalMode"),u=async i=>{var o,u;let d=async({previousCacheEntry:n})=>{try{if(!l&&A&&S&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await s(i);e.fetchMetrics=$.renderOpts.fetchMetrics;let o=$.renderOpts.pendingWaitUntil;o&&r.waitUntil&&(r.waitUntil(o),o=void 0);let u=$.renderOpts.collectedTags;if(!T)return await (0,h.sendResponse)(B,K,a,$.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,x.toNodeOutgoingHttpHeaders)(a.headers);u&&(t[f.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==$.renderOpts.collectedRevalidate&&!($.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&$.renderOpts.collectedRevalidate,n=void 0===$.renderOpts.collectedExpire||$.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:$.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==n?void 0:n.isStale)&&await E.onRequestError(e,t,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:A})},!1,I),t}},c=await E.handleResponse({req:e,nextConfig:b,cacheKey:O,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:S,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:l});if(!T)return null;if((null==c||null==(o=c.value)?void 0:o.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(u=c.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",A?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),j&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,x.fromNodeOutgoingHttpHeaders)(c.value.headers);return l&&T||p.delete(f.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,g.getCacheControlHeader)(c.cacheControl)),await (0,h.sendResponse)(B,K,new Response(c.value.body,{headers:p,status:c.value.status||200})),null};F?await u(F):await M.withPropagatedContext(e.headers,()=>M.trace(p.BaseServerSpan.handleRequest,{spanName:`${H} ${a}`,kind:o.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},u))}catch(t){if(t instanceof w.NoFallbackError||await E.onRequestError(e,t,{routerKind:"App Router",routePath:k,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:A})},!1,I),T)throw t;return await (0,h.sendResponse)(B,K,new Response(null,{status:500})),null}}e.s(["handler",()=>z,"patchFetch",()=>b,"routeModule",()=>E,"serverHooks",()=>I,"workAsyncStorage",()=>j,"workUnitAsyncStorage",()=>C]),r()}catch(e){r(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__0f1ce23e._.js.map