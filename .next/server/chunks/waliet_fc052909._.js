module.exports=[36621,(e,t,r)=>{"use strict";function s(e,t=""){if(!e)throw Error(t)}Object.defineProperty(r,"__esModule",{value:!0}),r.timingSafeEqual=void 0,r.timingSafeEqual=function(e,t){if(e.byteLength!==t.byteLength)return!1;e instanceof DataView||(e=new DataView(ArrayBuffer.isView(e)?e.buffer:e)),t instanceof DataView||(t=new DataView(ArrayBuffer.isView(t)?t.buffer:t)),s(e instanceof DataView),s(t instanceof DataView);let r=e.byteLength,i=0,n=-1;for(;++n<r;)i|=e.getUint8(n)^t.getUint8(n);return 0===i}},98930,(e,t,r)=>{"use strict";var s,i=e.e&&e.e.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e){void 0===e&&(e="="),this._paddingCharacter=e}return e.prototype.encodedLength=function(e){return this._paddingCharacter?(e+2)/3*4|0:(8*e+5)/6|0},e.prototype.encode=function(e){for(var t="",r=0;r<e.length-2;r+=3){var s=e[r]<<16|e[r+1]<<8|e[r+2];t+=this._encodeByte(s>>>18&63),t+=this._encodeByte(s>>>12&63),t+=this._encodeByte(s>>>6&63),t+=this._encodeByte(s>>>0&63)}var i=e.length-r;if(i>0){var s=e[r]<<16|(2===i?e[r+1]<<8:0);t+=this._encodeByte(s>>>18&63),t+=this._encodeByte(s>>>12&63),2===i?t+=this._encodeByte(s>>>6&63):t+=this._paddingCharacter||"",t+=this._paddingCharacter||""}return t},e.prototype.maxDecodedLength=function(e){return this._paddingCharacter?e/4*3|0:(6*e+7)/8|0},e.prototype.decodedLength=function(e){return this.maxDecodedLength(e.length-this._getPaddingLength(e))},e.prototype.decode=function(e){if(0===e.length)return new Uint8Array(0);for(var t=this._getPaddingLength(e),r=e.length-t,s=new Uint8Array(this.maxDecodedLength(r)),i=0,n=0,a=0,o=0,c=0,l=0,u=0;n<r-4;n+=4)o=this._decodeChar(e.charCodeAt(n+0)),c=this._decodeChar(e.charCodeAt(n+1)),l=this._decodeChar(e.charCodeAt(n+2)),u=this._decodeChar(e.charCodeAt(n+3)),s[i++]=o<<2|c>>>4,s[i++]=c<<4|l>>>2,s[i++]=l<<6|u,a|=256&o,a|=256&c,a|=256&l,a|=256&u;if(n<r-1&&(o=this._decodeChar(e.charCodeAt(n)),c=this._decodeChar(e.charCodeAt(n+1)),s[i++]=o<<2|c>>>4,a|=256&o,a|=256&c),n<r-2&&(l=this._decodeChar(e.charCodeAt(n+2)),s[i++]=c<<4|l>>>2,a|=256&l),n<r-3&&(u=this._decodeChar(e.charCodeAt(n+3)),s[i++]=l<<6|u,a|=256&u),0!==a)throw Error("Base64Coder: incorrect characters for decoding");return s},e.prototype._encodeByte=function(e){var t=e;return t+=65,t+=25-e>>>8&6,t+=51-e>>>8&-75,t+=61-e>>>8&-15,String.fromCharCode(t+=62-e>>>8&3)},e.prototype._decodeChar=function(e){return 256+((42-e&e-44)>>>8&-256+e-43+62)+((46-e&e-48)>>>8&-256+e-47+63)+((47-e&e-58)>>>8&-256+e-48+52)+((64-e&e-91)>>>8&-256+e-65+0)+((96-e&e-123)>>>8&-256+e-97+26)},e.prototype._getPaddingLength=function(e){var t=0;if(this._paddingCharacter){for(var r=e.length-1;r>=0&&e[r]===this._paddingCharacter;r--)t++;if(e.length<4||t>2)throw Error("Base64Coder: incorrect padding")}return t},e}();r.Coder=n;var a=new n;r.encode=function(e){return a.encode(e)},r.decode=function(e){return a.decode(e)};var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype._encodeByte=function(e){var t=e;return t+=65,t+=25-e>>>8&6,t+=51-e>>>8&-75,t+=61-e>>>8&-13,String.fromCharCode(t+=62-e>>>8&49)},t.prototype._decodeChar=function(e){return 256+((44-e&e-46)>>>8&-256+e-45+62)+((94-e&e-96)>>>8&-256+e-95+63)+((47-e&e-58)>>>8&-256+e-48+52)+((64-e&e-91)>>>8&-256+e-65+0)+((96-e&e-123)>>>8&-256+e-97+26)},t}(n);r.URLSafeCoder=o;var c=new o;r.encodeURLSafe=function(e){return c.encode(e)},r.decodeURLSafe=function(e){return c.decode(e)},r.encodedLength=function(e){return a.encodedLength(e)},r.maxDecodedLength=function(e){return a.maxDecodedLength(e)},r.decodedLength=function(e){return a.decodedLength(e)}},23314,(e,t,r)=>{!function(r,s){var i={};s(i);var n=i.default;for(var a in i)n[a]=i[a];if("object"==typeof t.exports)t.exports=n;else if("function"==typeof define&&define.amd)e.r,void 0!==n&&e.v(n);else r.sha256=n}(e.e,function(e){"use strict";e.__esModule=!0,e.digestLength=32,e.blockSize=64;var t=new Uint32Array([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]);function r(e,r,s,i,n){for(var a,o,c,l,u,h,d,p,f,y,m,g,w;n>=64;){for(y=0,a=r[0],o=r[1],c=r[2],l=r[3],u=r[4],h=r[5],d=r[6],p=r[7];y<16;y++)m=i+4*y,e[y]=(255&s[m])<<24|(255&s[m+1])<<16|(255&s[m+2])<<8|255&s[m+3];for(y=16;y<64;y++)g=((f=e[y-2])>>>17|f<<15)^(f>>>19|f<<13)^f>>>10,w=((f=e[y-15])>>>7|f<<25)^(f>>>18|f<<14)^f>>>3,e[y]=(g+e[y-7]|0)+(w+e[y-16]|0);for(y=0;y<64;y++)g=(((u>>>6|u<<26)^(u>>>11|u<<21)^(u>>>25|u<<7))+(u&h^~u&d)|0)+(p+(t[y]+e[y]|0)|0)|0,w=((a>>>2|a<<30)^(a>>>13|a<<19)^(a>>>22|a<<10))+(a&o^a&c^o&c)|0,p=d,d=h,h=u,u=l+g|0,l=c,c=o,o=a,a=g+w|0;r[0]+=a,r[1]+=o,r[2]+=c,r[3]+=l,r[4]+=u,r[5]+=h,r[6]+=d,r[7]+=p,i+=64,n-=64}return i}var s=function(){function t(){this.digestLength=e.digestLength,this.blockSize=e.blockSize,this.state=new Int32Array(8),this.temp=new Int32Array(64),this.buffer=new Uint8Array(128),this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this.reset()}return t.prototype.reset=function(){return this.state[0]=0x6a09e667,this.state[1]=0xbb67ae85,this.state[2]=0x3c6ef372,this.state[3]=0xa54ff53a,this.state[4]=0x510e527f,this.state[5]=0x9b05688c,this.state[6]=0x1f83d9ab,this.state[7]=0x5be0cd19,this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this},t.prototype.clean=function(){for(var e=0;e<this.buffer.length;e++)this.buffer[e]=0;for(var e=0;e<this.temp.length;e++)this.temp[e]=0;this.reset()},t.prototype.update=function(e,t){if(void 0===t&&(t=e.length),this.finished)throw Error("SHA256: can't update because hash was finished.");var s=0;if(this.bytesHashed+=t,this.bufferLength>0){for(;this.bufferLength<64&&t>0;)this.buffer[this.bufferLength++]=e[s++],t--;64===this.bufferLength&&(r(this.temp,this.state,this.buffer,0,64),this.bufferLength=0)}for(t>=64&&(s=r(this.temp,this.state,e,s,t),t%=64);t>0;)this.buffer[this.bufferLength++]=e[s++],t--;return this},t.prototype.finish=function(e){if(!this.finished){var t=this.bytesHashed,s=this.bufferLength,i=t/0x20000000|0,n=t<<3,a=t%64<56?64:128;this.buffer[s]=128;for(var o=s+1;o<a-8;o++)this.buffer[o]=0;this.buffer[a-8]=i>>>24&255,this.buffer[a-7]=i>>>16&255,this.buffer[a-6]=i>>>8&255,this.buffer[a-5]=i>>>0&255,this.buffer[a-4]=n>>>24&255,this.buffer[a-3]=n>>>16&255,this.buffer[a-2]=n>>>8&255,this.buffer[a-1]=n>>>0&255,r(this.temp,this.state,this.buffer,0,a),this.finished=!0}for(var o=0;o<8;o++)e[4*o+0]=this.state[o]>>>24&255,e[4*o+1]=this.state[o]>>>16&255,e[4*o+2]=this.state[o]>>>8&255,e[4*o+3]=this.state[o]>>>0&255;return this},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype._saveState=function(e){for(var t=0;t<this.state.length;t++)e[t]=this.state[t]},t.prototype._restoreState=function(e,t){for(var r=0;r<this.state.length;r++)this.state[r]=e[r];this.bytesHashed=t,this.finished=!1,this.bufferLength=0},t}();e.Hash=s;var i=function(){function e(e){this.inner=new s,this.outer=new s,this.blockSize=this.inner.blockSize,this.digestLength=this.inner.digestLength;var t=new Uint8Array(this.blockSize);if(e.length>this.blockSize)new s().update(e).finish(t).clean();else for(var r=0;r<e.length;r++)t[r]=e[r];for(var r=0;r<t.length;r++)t[r]^=54;this.inner.update(t);for(var r=0;r<t.length;r++)t[r]^=106;this.outer.update(t),this.istate=new Uint32Array(8),this.ostate=new Uint32Array(8),this.inner._saveState(this.istate),this.outer._saveState(this.ostate);for(var r=0;r<t.length;r++)t[r]=0}return e.prototype.reset=function(){return this.inner._restoreState(this.istate,this.inner.blockSize),this.outer._restoreState(this.ostate,this.outer.blockSize),this},e.prototype.clean=function(){for(var e=0;e<this.istate.length;e++)this.ostate[e]=this.istate[e]=0;this.inner.clean(),this.outer.clean()},e.prototype.update=function(e){return this.inner.update(e),this},e.prototype.finish=function(e){return this.outer.finished?this.outer.finish(e):(this.inner.finish(e),this.outer.update(e,this.digestLength).finish(e)),this},e.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},e}();function n(e){var t=new s().update(e),r=t.digest();return t.clean(),r}function a(e,t){var r=new i(e).update(t),s=r.digest();return r.clean(),s}e.HMAC=i,e.hash=n,e.default=n,e.hmac=a;var o=new Uint8Array(e.digestLength);e.hkdf=function(e,t,r,s){void 0===t&&(t=o),void 0===s&&(s=32);for(var n=new Uint8Array([1]),c=new i(a(t,e)),l=new Uint8Array(c.digestLength),u=l.length,h=new Uint8Array(s),d=0;d<s;d++)u===l.length&&(!function(e,t,r,s){var i=s[0];if(0===i)throw Error("hkdf: cannot expand more");t.reset(),i>1&&t.update(e),r&&t.update(r),t.update(s),t.finish(e),s[0]++}(l,c,r,n),u=0),h[d]=l[u++];return c.clean(),l.fill(0),n.fill(0),h},e.pbkdf2=function(e,t,r,s){for(var n=new i(e),a=n.digestLength,o=new Uint8Array(4),c=new Uint8Array(a),l=new Uint8Array(a),u=new Uint8Array(s),h=0;h*a<s;h++){var d=h+1;o[0]=d>>>24&255,o[1]=d>>>16&255,o[2]=d>>>8&255,o[3]=d>>>0&255,n.reset(),n.update(t),n.update(o),n.finish(l);for(var p=0;p<a;p++)c[p]=l[p];for(var p=2;p<=r;p++){n.reset(),n.update(l).finish(l);for(var f=0;f<a;f++)c[f]^=l[f]}for(var p=0;p<a&&h*a+p<s;p++)u[h*a+p]=c[p]}for(var h=0;h<a;h++)c[h]=l[h]=0;for(var h=0;h<4;h++)o[h]=0;return n.clean(),u}})},10355,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Webhook=r.WebhookVerificationError=void 0;let s=e.r(36621),i=e.r(98930),n=e.r(23314);class a extends Error{constructor(e){super(e),Object.setPrototypeOf(this,a.prototype),this.name="ExtendableError",this.stack=Error(e).stack}}class o extends a{constructor(e){super(e),Object.setPrototypeOf(this,o.prototype),this.name="WebhookVerificationError"}}r.WebhookVerificationError=o;class c{constructor(e,t){if(!e)throw Error("Secret can't be empty.");if((null==t?void 0:t.format)==="raw")e instanceof Uint8Array?this.key=e:this.key=Uint8Array.from(e,e=>e.charCodeAt(0));else{if("string"!=typeof e)throw Error("Expected secret to be of type string");e.startsWith(c.prefix)&&(e=e.substring(c.prefix.length)),this.key=i.decode(e)}}verify(e,t){let r={};for(let e of Object.keys(t))r[e.toLowerCase()]=t[e];let i=r["webhook-id"],n=r["webhook-signature"],a=r["webhook-timestamp"];if(!n||!i||!a)throw new o("Missing required headers");let c=this.verifyTimestamp(a),l=this.sign(i,c,e).split(",")[1],u=n.split(" "),h=new globalThis.TextEncoder;for(let t of u){let[r,i]=t.split(",");if("v1"===r&&(0,s.timingSafeEqual)(h.encode(i),h.encode(l)))return JSON.parse(e.toString())}throw new o("No matching signature found")}sign(e,t,r){if("string"==typeof r);else if("Buffer"===r.constructor.name)r=r.toString();else throw Error("Expected payload to be of type string or Buffer.");let s=new TextEncoder,a=Math.floor(t.getTime()/1e3),o=s.encode(`${e}.${a}.${r}`),c=i.encode(n.hmac(this.key,o));return`v1,${c}`}verifyTimestamp(e){let t=Math.floor(Date.now()/1e3),r=parseInt(e,10);if(isNaN(r))throw new o("Invalid Signature Headers");if(t-r>300)throw new o("Message timestamp too old");if(r>t+300)throw new o("Message timestamp too new");return new Date(1e3*r)}}r.Webhook=c,c.prefix="whsec_"},83974,e=>{"use strict";let t,r,s;function i(e,t,r,s,i){if("m"===s)throw TypeError("Private method is not writable");if("a"===s&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?i.call(e,r):i?i.value=r:t.set(e,r),r}function n(e,t,r,s){if("a"===r&&!s)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)}let a=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return a=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),r=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^r()&15>>e/4).toString(16))},o=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class c extends Error{}class l extends c{constructor(e,t,r,s){super(`${l.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.error=t}static makeMessage(e,t,r){let s=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){return e&&s?400===e?new p(e,t,r,s):401===e?new f(e,t,r,s):403===e?new y(e,t,r,s):404===e?new m(e,t,r,s):409===e?new g(e,t,r,s):422===e?new w(e,t,r,s):429===e?new b(e,t,r,s):e>=500?new _(e,t,r,s):new l(e,t,r,s):new h({message:r,cause:o(t)})}}class u extends l{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class h extends l{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class d extends h{constructor({message:e}={}){super({message:e??"Request timed out."})}}class p extends l{}class f extends l{}class y extends l{}class m extends l{}class g extends l{}class w extends l{}class b extends l{}class _ extends l{}let v=/^[a-z][a-z0-9+.-]*:/i,S=e=>(S=Array.isArray)(e),A=S,E=e=>new Promise(t=>setTimeout(t,e)),x="0.0.23",k=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",P=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";function R(){if("u">typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Whop({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}async function $(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void await e[Symbol.asyncIterator]().return?.();let t=e.getReader(),r=t.cancel();t.releaseLock(),await r}let I=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),T="RFC3986",C=e=>String(e),O={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:C},L=(e,t)=>(L=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty))(e,t),D=(()=>{let e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();function K(e,t){if(S(e)){let r=[];for(let s=0;s<e.length;s+=1)r.push(t(e[s]));return r}return t(e)}let W={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},H=function(e,t){Array.prototype.push.apply(e,S(t)?t:[t])},U={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,r,s,i)=>{if(0===e.length)return e;let n=e;if("symbol"==typeof e?n=Symbol.prototype.toString.call(e):"string"!=typeof e&&(n=String(e)),"iso-8859-1"===r)return escape(n).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let a="";for(let e=0;e<n.length;e+=1024){let t=n.length>=1024?n.slice(e,e+1024):n,r=[];for(let e=0;e<t.length;++e){let s=t.charCodeAt(e);if(45===s||46===s||95===s||126===s||s>=48&&s<=57||s>=65&&s<=90||s>=97&&s<=122||"RFC1738"===i&&(40===s||41===s)){r[r.length]=t.charAt(e);continue}if(s<128){r[r.length]=D[s];continue}if(s<2048){r[r.length]=D[192|s>>6]+D[128|63&s];continue}if(s<55296||s>=57344){r[r.length]=D[224|s>>12]+D[128|s>>6&63]+D[128|63&s];continue}e+=1,s=65536+((1023&s)<<10|1023&t.charCodeAt(e)),r[r.length]=D[240|s>>18]+D[128|s>>12&63]+D[128|s>>6&63]+D[128|63&s]}a+=r.join("")}return a},encodeValuesOnly:!1,format:T,formatter:C,indices:!1,serializeDate:e=>(r??(r=Function.prototype.call.bind(Date.prototype.toISOString)))(e),skipNulls:!1,strictNullHandling:!1},j={},M={off:0,error:200,warn:300,info:400,debug:500},N=(e,t,r)=>{if(e){if(Object.prototype.hasOwnProperty.call(M,e))return e;V(r).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(M))}`)}};function J(){}function F(e,t,r){return!t||M[e]>M[r]?J:t[e].bind(t)}let B={error:J,warn:J,info:J,debug:J},q=new WeakMap;function V(e){let t=e.logger,r=e.logLevel??"off";if(!t)return B;let s=q.get(t);if(s&&s[0]===r)return s[1];let i={error:F("error",t,r),warn:F("warn",t,r),info:F("info",t,r),debug:F("debug",t,r)};return q.set(t,[r,i]),i}let X=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);async function z(e,t){let{response:r,requestLogID:s,retryOfRequestLogID:i,startTime:n}=t,a=await (async()=>{if(204===r.status)return null;if(t.options.__binaryResponse)return r;let e=r.headers.get("content-type"),s=e?.split(";")[0]?.trim();return s?.includes("application/json")||s?.endsWith("+json")?await r.json():await r.text()})();return V(e).debug(`[${s}] response parsed`,X({retryOfRequestLogID:i,url:r.url,status:r.status,body:a,durationMs:Date.now()-n})),a}class G extends Promise{constructor(e,t,r=z){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=r,eZ.set(this,void 0),i(this,eZ,e,"f")}_thenUnwrap(e){return new G(n(this,eZ,"f"),this.responsePromise,async(t,r)=>e(await this.parseResponse(t,r),r))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(n(this,eZ,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}eZ=new WeakMap;class Y{constructor(e,t,r,s){e0.set(this,void 0),i(this,e0,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new c("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await n(this,e0,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(e0=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class Q extends G{constructor(e,t,r){super(e,t,async(e,t)=>new r(e,t.response,await z(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class Z extends Y{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.page_info=r.page_info||{}}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){var e;let t=this.page_info?.end_cursor;return t?{...this.options,query:{..."object"!=typeof(e=this.options.query)?{}:e??{},after:t}}:null}}let ee=()=>{if("u"<typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function et(e,t,r){return ee(),new File(e,t??"unknown_file",r)}let er=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function es(e,t,r){var s;let i,n;if(ee(),null!=(i=e=await e)&&"object"==typeof i&&"string"==typeof i.name&&"number"==typeof i.lastModified&&er(i))return e instanceof File?e:et([await e.arrayBuffer()],e.name);if(null!=(n=e)&&"object"==typeof n&&"string"==typeof n.url&&"function"==typeof n.blob){let s=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),et(await ei(s),t,r)}let a=await ei(e);if(t||(t=("object"==typeof(s=e)&&null!==s&&("name"in s&&s.name&&String(s.name)||"url"in s&&s.url&&String(s.url)||"filename"in s&&s.filename&&String(s.filename)||"path"in s&&s.path&&String(s.path))||"").split(/[\\/]/).pop()||void 0),!r?.type){let e=a.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(r={...r,type:e})}return et(a,t,r)}async function ei(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(er(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else{let r;if(null!=(r=e)&&"object"==typeof r&&"function"==typeof r[Symbol.asyncIterator])for await(let r of e)t.push(...await ei(r));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}}return t}class en{constructor(e){this._client=e}}class ea extends en{create(e,t){return this._client.post("/access_tokens",{body:e,...t})}}class eo extends en{create(e,t){return this._client.post("/account_links",{body:e,...t})}}function ec(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let el=Object.freeze(Object.create(null)),eu=((e=ec)=>function(t,...r){let s;if(1===t.length)return t[0];let i=!1,n=[],a=t.reduce((t,s,a)=>{/[?#]/.test(s)&&(i=!0);let o=r[a],c=(i?encodeURIComponent:e)(""+o);return a!==r.length&&(null==o||"object"==typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??el)??el)?.toString)&&(c=o+"",n.push({start:t.length+s.length,length:c.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+s+(a===r.length?"":c)},""),o=a.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(s=l.exec(o));)n.push({start:s.index,length:s[0].length,error:`Value "${s[0]}" can't be safely passed as a path parameter`});if(n.sort((e,t)=>e.start-t.start),n.length>0){let e=0,t=n.reduce((t,r)=>{let s=" ".repeat(r.start-e),i="^".repeat(r.length);return e=r.start+r.length,t+s+i},"");throw new c(`Path parameters result in path with invalid segments:
${n.map(e=>e.error).join("\n")}
${a}
${t}`)}return a})(ec);class eh extends en{create(e,t){return this._client.post("/app_builds",{body:e,...t})}retrieve(e,t){return this._client.get(eu`/app_builds/${e}`,t)}list(e,t){return this._client.getAPIList("/app_builds",Z,{query:e,...t})}promote(e,t){return this._client.post(eu`/app_builds/${e}/promote`,t)}}class ed extends en{create(e,t){return this._client.post("/apps",{body:e,...t})}retrieve(e,t){return this._client.get(eu`/apps/${e}`,t)}update(e,t={},r){return this._client.patch(eu`/apps/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/apps",Z,{query:e,...t})}}class ep extends en{retrieve(e,t){return this._client.get(eu`/authorized_users/${e}`,t)}list(e,t){return this._client.getAPIList("/authorized_users",Z,{query:e,...t})}}class ef extends en{retrieve(e,t){return this._client.get(eu`/chat_channels/${e}`,t)}update(e,t={},r){return this._client.patch(eu`/chat_channels/${e}`,{body:t,...r})}list(e,t){return this._client.getAPIList("/chat_channels",Z,{query:e,...t})}}class ey extends en{create(e,t){return this._client.post("/checkout_configurations",{body:e,...t})}retrieve(e,t){return this._client.get(eu`/checkout_configurations/${e}`,t)}list(e,t){return this._client.getAPIList("/checkout_configurations",Z,{query:e,...t})}}class em extends en{create(e,t){return this._client.post("/companies",{body:e,...t})}retrieve(e,t){return this._client.get(eu`/companies/${e}`,t)}update(e,t={},r){return this._client.patch(eu`/companies/${e}`,{body:t,...r})}list(e,t){return this._client.getAPIList("/companies",Z,{query:e,...t})}}class eg extends en{create(e,t){return this._client.post("/course_chapters",{body:e,...t})}retrieve(e,t){return this._client.get(eu`/course_chapters/${e}`,t)}update(e,t,r){return this._client.patch(eu`/course_chapters/${e}`,{body:t,...r})}list(e,t){return this._client.getAPIList("/course_chapters",Z,{query:e,...t})}delete(e,t){return this._client.delete(eu`/course_chapters/${e}`,t)}}class ew extends en{retrieve(e,t){return this._client.get(eu`/course_lesson_interactions/${e}`,t)}list(e={},t){return this._client.getAPIList("/course_lesson_interactions",Z,{query:e,...t})}}class eb extends en{create(e,t){return this._client.post("/course_lessons",{body:e,...t})}retrieve(e,t){return this._client.get(eu`/course_lessons/${e}`,t)}update(e,t={},r){return this._client.patch(eu`/course_lessons/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/course_lessons",Z,{query:e,...t})}delete(e,t){return this._client.delete(eu`/course_lessons/${e}`,t)}markAsCompleted(e,t){return this._client.post(eu`/course_lessons/${e}/mark_as_completed`,t)}start(e,t){return this._client.post(eu`/course_lessons/${e}/start`,t)}submitAssessment(e,t,r){return this._client.post(eu`/course_lessons/${e}/submit_assessment`,{body:t,...r})}}class e_ extends en{retrieve(e,t){return this._client.get(eu`/course_students/${e}`,t)}list(e,t){return this._client.getAPIList("/course_students",Z,{query:e,...t})}}class ev extends en{create(e,t){return this._client.post("/courses",{body:e,...t})}retrieve(e,t){return this._client.get(eu`/courses/${e}`,t)}update(e,t={},r){return this._client.patch(eu`/courses/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/courses",Z,{query:e,...t})}delete(e,t){return this._client.delete(eu`/courses/${e}`,t)}}class eS extends en{retrieve(e,t){return this._client.get(eu`/disputes/${e}`,t)}list(e,t){return this._client.getAPIList("/disputes",Z,{query:e,...t})}submitEvidence(e,t){return this._client.post(eu`/disputes/${e}/submit_evidence`,t)}updateEvidence(e,t={},r){return this._client.post(eu`/disputes/${e}/update_evidence`,{body:t,...r})}}class eA extends en{retrieve(e,t){return this._client.get(eu`/entries/${e}`,t)}list(e,t){return this._client.getAPIList("/entries",Z,{query:e,...t})}approve(e,t){return this._client.post(eu`/entries/${e}/approve`,t)}deny(e,t){return this._client.post(eu`/entries/${e}/deny`,t)}}class eE extends en{create(e,t){return this._client.post("/experiences",{body:e,...t})}retrieve(e,t){return this._client.get(eu`/experiences/${e}`,t)}update(e,t={},r){return this._client.patch(eu`/experiences/${e}`,{body:t,...r})}list(e,t){return this._client.getAPIList("/experiences",Z,{query:e,...t})}delete(e,t){return this._client.delete(eu`/experiences/${e}`,t)}attach(e,t,r){return this._client.post(eu`/experiences/${e}/attach`,{body:t,...r})}detach(e,t,r){return this._client.post(eu`/experiences/${e}/detach`,{body:t,...r})}duplicate(e,t={},r){return this._client.post(eu`/experiences/${e}/duplicate`,{body:t,...r})}}class ex extends en{create(e,t){return this._client.post("/fee_markups",{body:e,...t})}list(e,t){return this._client.getAPIList("/fee_markups",Z,{query:e,...t})}delete(e,t){return this._client.delete(eu`/fee_markups/${e}`,t)}}async function ek(e,t,r){let s=r?.pollIntervalMs??1e3,i=r?.pollTimeoutMs??12e4,n=r?.requestOptions??void 0,a=await es(t,r?.filename??void 0),o=(r?.filename??a.name)?.trim();if(!o)throw Error("uploadFile: could not determine a filename; pass { filename } or provide a named File.");let c=await e.files.create({filename:o},n);if("failed"===c.upload_status)throw Error(`uploadFile: file creation failed (id: ${c.id}).`);if("ready"!==c.upload_status){if(!c.upload_url)throw Error("uploadFile: missing upload_url from files.create response.");let t=e.fetch??R(),r=await t(c.upload_url,{method:"PUT",headers:function(e){if(!e)return;let t={};for(let[r,s]of Object.entries(e))null!=s&&(t[r]=String(s));return t}(c.upload_headers)??{},body:a});if(!r.ok)throw Error(`uploadFile: upload failed (status ${r.status} ${r.statusText}).`)}let l=Date.now()+i;for(;;){let t=await e.files.retrieve(c.id,n);if("ready"===t.upload_status)return t;if("failed"===t.upload_status)throw Error(`uploadFile: processing failed (id: ${t.id}).`);if(Date.now()>=l)throw Error(`uploadFile: timed out waiting for file to become ready (id: ${t.id}).`);await E(s)}}class eP extends en{create(e,t){return this._client.post("/files",{body:e,...t})}retrieve(e,t){return this._client.get(eu`/files/${e}`,t)}upload(e,t){let{filename:r,...s}=t??{};return ek(this._client,e,{filename:r,requestOptions:s})}}class eR extends en{create(e,t){return this._client.post("/forum_posts",{body:e,...t})}retrieve(e,t){return this._client.get(eu`/forum_posts/${e}`,t)}update(e,t={},r){return this._client.patch(eu`/forum_posts/${e}`,{body:t,...r})}list(e,t){return this._client.getAPIList("/forum_posts",Z,{query:e,...t})}}class e$ extends en{retrieve(e,t){return this._client.get(eu`/forums/${e}`,t)}update(e,t={},r){return this._client.patch(eu`/forums/${e}`,{body:t,...r})}list(e,t){return this._client.getAPIList("/forums",Z,{query:e,...t})}}class eI extends en{create(e,t){return this._client.post("/invoices",{body:e,...t})}retrieve(e,t){return this._client.get(eu`/invoices/${e}`,t)}list(e,t){return this._client.getAPIList("/invoices",Z,{query:e,...t})}void(e,t){return this._client.post(eu`/invoices/${e}/void`,t)}}class eT extends en{create(e,t){return this._client.post("/leads",{body:e,...t})}retrieve(e,t){return this._client.get(eu`/leads/${e}`,t)}update(e,t={},r){return this._client.patch(eu`/leads/${e}`,{body:t,...r})}list(e,t){return this._client.getAPIList("/leads",Z,{query:e,...t})}}class eC extends en{retrieve(e,t){return this._client.get(eu`/ledger_accounts/${e}`,t)}}class eO extends en{retrieve(e,t){return this._client.get(eu`/members/${e}`,t)}list(e,t){return this._client.getAPIList("/members",Z,{query:e,...t})}}class eL extends en{retrieve(e,t){return this._client.get(eu`/memberships/${e}`,t)}update(e,t={},r){return this._client.patch(eu`/memberships/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/memberships",Z,{query:e,...t})}cancel(e,t={},r){return this._client.post(eu`/memberships/${e}/cancel`,{body:t,...r})}pause(e,t={},r){return this._client.post(eu`/memberships/${e}/pause`,{body:t,...r})}resume(e,t){return this._client.post(eu`/memberships/${e}/resume`,t)}}class eD extends en{create(e,t){return this._client.post("/messages",{body:e,...t})}retrieve(e,t){return this._client.get(eu`/messages/${e}`,t)}update(e,t={},r){return this._client.patch(eu`/messages/${e}`,{body:t,...r})}list(e,t){return this._client.getAPIList("/messages",Z,{query:e,...t})}}class eK extends en{create(e,t){return this._client.post("/notifications",{body:e,...t})}}class eW extends en{retrieve(e,t={},r){return this._client.get(eu`/payment_methods/${e}`,{query:t,...r})}list(e={},t){return this._client.getAPIList("/payment_methods",Z,{query:e,...t})}}class eH extends en{create(e,t){return this._client.post("/payments",{body:e,...t})}retrieve(e,t){return this._client.get(eu`/payments/${e}`,t)}list(e,t){return this._client.getAPIList("/payments",Z,{query:e,...t})}listFees(e,t={},r){return this._client.getAPIList(eu`/payments/${e}/fees`,Z,{query:t,...r})}refund(e,t={},r){return this._client.post(eu`/payments/${e}/refund`,{body:t,...r})}retry(e,t){return this._client.post(eu`/payments/${e}/retry`,t)}void(e,t){return this._client.post(eu`/payments/${e}/void`,t)}}class eU extends en{retrieve(e,t){return this._client.get(eu`/payout_methods/${e}`,t)}list(e,t){return this._client.getAPIList("/payout_methods",Z,{query:e,...t})}}class ej extends en{create(e,t){return this._client.post("/plans",{body:e,...t})}retrieve(e,t){return this._client.get(eu`/plans/${e}`,t)}update(e,t={},r){return this._client.patch(eu`/plans/${e}`,{body:t,...r})}list(e,t){return this._client.getAPIList("/plans",Z,{query:e,...t})}delete(e,t){return this._client.delete(eu`/plans/${e}`,t)}}class eM extends en{create(e,t){return this._client.post("/products",{body:e,...t})}retrieve(e,t){return this._client.get(eu`/products/${e}`,t)}update(e,t={},r){return this._client.patch(eu`/products/${e}`,{body:t,...r})}list(e,t){return this._client.getAPIList("/products",Z,{query:e,...t})}delete(e,t){return this._client.delete(eu`/products/${e}`,t)}}class eN extends en{create(e,t){return this._client.post("/promo_codes",{body:e,...t})}retrieve(e,t){return this._client.get(eu`/promo_codes/${e}`,t)}list(e,t){return this._client.getAPIList("/promo_codes",Z,{query:e,...t})}delete(e,t){return this._client.delete(eu`/promo_codes/${e}`,t)}}class eJ extends en{create(e,t){return this._client.post("/reactions",{body:e,...t})}retrieve(e,t){return this._client.get(eu`/reactions/${e}`,t)}list(e,t){return this._client.getAPIList("/reactions",Z,{query:e,...t})}}class eF extends en{retrieve(e,t){return this._client.get(eu`/refunds/${e}`,t)}list(e,t){return this._client.getAPIList("/refunds",Z,{query:e,...t})}}class eB extends en{retrieve(e,t){return this._client.get(eu`/reviews/${e}`,t)}list(e,t){return this._client.getAPIList("/reviews",Z,{query:e,...t})}}class eq extends en{retrieve(e,t){return this._client.get(eu`/setup_intents/${e}`,t)}list(e,t){return this._client.getAPIList("/setup_intents",Z,{query:e,...t})}}class eV extends en{create(e,t){return this._client.post("/shipments",{body:e,...t})}retrieve(e,t){return this._client.get(eu`/shipments/${e}`,t)}list(e={},t){return this._client.getAPIList("/shipments",Z,{query:e,...t})}}class eX extends en{create(e,t){return this._client.post("/support_channels",{body:e,...t})}retrieve(e,t){return this._client.get(eu`/support_channels/${e}`,t)}list(e,t){return this._client.getAPIList("/support_channels",Z,{query:e,...t})}}class ez extends en{create(e,t){return this._client.post("/topups",{body:e,...t})}}class eG extends en{create(e,t){return this._client.post("/transfers",{body:e,...t})}retrieve(e,t){return this._client.get(eu`/transfers/${e}`,t)}list(e={},t){return this._client.getAPIList("/transfers",Z,{query:e,...t})}}class eY extends en{retrieve(e,t){return this._client.get(eu`/users/${e}`,t)}checkAccess(e,t,r){let{id:s}=t;return this._client.get(eu`/users/${s}/access/${e}`,r)}}class eQ extends en{retrieve(e,t){return this._client.get(eu`/verifications/${e}`,t)}}var eZ,e0,e2,e1,e5,e6,e8=e.i(10355);class e4 extends en{create(e,t){return this._client.post("/webhooks",{body:e,...t})}retrieve(e,t){return this._client.get(eu`/webhooks/${e}`,t)}update(e,t={},r){return this._client.patch(eu`/webhooks/${e}`,{body:t,...r})}list(e,t){return this._client.getAPIList("/webhooks",Z,{query:e,...t})}delete(e,t){return this._client.delete(eu`/webhooks/${e}`,t)}unwrap(e,{headers:t,key:r}){if(void 0!==t){let s=void 0===r?this._client.webhookKey:r;if(null===s)throw Error("Webhook key must not be null in order to unwrap");new e8.Webhook(s).verify(e,t)}return JSON.parse(e)}}class e3 extends en{create(e,t){return this._client.post("/withdrawals",{body:e,...t})}retrieve(e,t){return this._client.get(eu`/withdrawals/${e}`,t)}list(e,t){return this._client.getAPIList("/withdrawals",Z,{query:e,...t})}}let e9=Symbol("brand.privateNullableHeaders"),e7=e=>{let t=new Headers,r=new Set;for(let s of e){let e=new Set;for(let[i,n]of function*(e){let t;if(!e)return;if(e9 in e){let{values:t,nulls:r}=e;for(let e of(yield*t.entries(),r))yield[e,null];return}let r=!1;for(let s of(e instanceof Headers?t=e.entries():A(e)?t=e:(r=!0,t=Object.entries(e??{})),t)){let e=s[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=A(s[1])?s[1]:[s[1]],i=!1;for(let s of t)void 0!==s&&(r&&!i&&(i=!0,yield[e,null]),yield[e,s])}}(s)){let s=i.toLowerCase();e.has(s)||(t.delete(i),e.add(s)),null===n?(t.delete(i),r.add(s)):(t.append(i,n),r.delete(s))}}return{[e9]:!0,values:t,nulls:r}},te=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0,tt=new TextEncoder,tr=new TextDecoder;function ts(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++){let s=e.charCodeAt(r);if(s>127)throw TypeError("non-ASCII string encountered in encode()");t[r]=s}return t}function ti(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64("string"==typeof e?e:tr.decode(e),{alphabet:"base64url"});let t=e;t instanceof Uint8Array&&(t=tr.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/");try{var r=t;if(Uint8Array.fromBase64)return Uint8Array.fromBase64(r);let e=atob(r),s=new Uint8Array(e.length);for(let t=0;t<e.length;t++)s[t]=e.charCodeAt(t);return s}catch{throw TypeError("The input to be decoded is not correctly encoded.")}}class tn extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(e,t){super(e,t),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class ta extends tn{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(e,t,r="unspecified",s="unspecified"){super(e,{cause:{claim:r,reason:s,payload:t}}),this.claim=r,this.reason=s,this.payload=t}}class to extends tn{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(e,t,r="unspecified",s="unspecified"){super(e,{cause:{claim:r,reason:s,payload:t}}),this.claim=r,this.reason=s,this.payload=t}}class tc extends tn{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class tl extends tn{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class tu extends tn{static code="ERR_JWS_INVALID";code="ERR_JWS_INVALID"}class th extends tn{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class td extends tn{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t)}}class tp extends tn{static code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";constructor(e="signature verification failed",t){super(e,t)}}async function tf(e){if(!e.alg)throw TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:t,keyUsages:r}=function(e){let t,r;switch(e.kty){case"AKP":switch(e.alg){case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":t={name:e.alg},r=e.priv?["sign"]:["verify"];break;default:throw new tl('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new tl('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},r=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},r=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new tl('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(e.alg){case"Ed25519":case"EdDSA":t={name:"Ed25519"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new tl('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new tl('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}(e),s={...e};return"AKP"!==s.kty&&delete s.alg,delete s.use,crypto.subtle.importKey("jwk",s,t,e.ext??(!e.d&&!e.priv),e.key_ops??r)}function ty(e){if("object"!=typeof e||null===e||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}async function tm(e,t,r){let s;if(!ty(e))throw TypeError("JWK must be an object");switch(t??=e.alg,s??=r?.extractable??e.ext,e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');return ti(e.k);case"RSA":if("oth"in e&&void 0!==e.oth)throw new tl('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');return tf({...e,alg:t,ext:s});case"AKP":if("string"!=typeof e.alg||!e.alg)throw TypeError('missing "alg" (Algorithm) Parameter value');if(void 0!==t&&t!==e.alg)throw TypeError("JWK alg and alg option value mismatch");return tf({...e,ext:s});case"EC":case"OKP":return tf({...e,alg:t,ext:s});default:throw new tl('Unsupported "kty" (Key Type) Parameter value')}}let tg=(e,t="algorithm.name")=>TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`);function tw(e){return parseInt(e.name.slice(4),10)}function tb(e,t,...r){if((r=r.filter(Boolean)).length>2){let t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}let t_=(e,t,...r)=>tb(`Key for the ${e} algorithm must be `,t,...r);async function tv(e,t,r){if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw TypeError(((e,...t)=>tb("Key must be ",e,...t))(t,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",t,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[r])}return!function(e,t,r){switch(t){case"HS256":case"HS384":case"HS512":{if("HMAC"!==e.algorithm.name)throw tg("HMAC");let r=parseInt(t.slice(2),10);if(tw(e.algorithm.hash)!==r)throw tg(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if("RSASSA-PKCS1-v1_5"!==e.algorithm.name)throw tg("RSASSA-PKCS1-v1_5");let r=parseInt(t.slice(2),10);if(tw(e.algorithm.hash)!==r)throw tg(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if("RSA-PSS"!==e.algorithm.name)throw tg("RSA-PSS");let r=parseInt(t.slice(2),10);if(tw(e.algorithm.hash)!==r)throw tg(`SHA-${r}`,"algorithm.hash");break}case"Ed25519":case"EdDSA":if("Ed25519"!==e.algorithm.name)throw tg("Ed25519");break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":let s;if(s=e.algorithm,s.name!==t)throw tg(t);break;case"ES256":case"ES384":case"ES512":{if("ECDSA"!==e.algorithm.name)throw tg("ECDSA");let r=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(t);if(e.algorithm.namedCurve!==r)throw tg(r,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}if(r&&!e.usages.includes(r))throw TypeError(`CryptoKey does not support this operation, its usages must include ${r}.`)}(t,e,r),t}async function tS(e,t,r,s){let i=await tv(e,t,"verify");!function(e,t){if(e.startsWith("RS")||e.startsWith("PS")){let{modulusLength:r}=t.algorithm;if("number"!=typeof r||r<2048)throw TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}}(e,i);let n=function(e,t){let r=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:parseInt(e.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:t.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return{name:e};default:throw new tl(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}(e,i.algorithm);try{return await crypto.subtle.verify(n,i,r,s)}catch{return!1}}let tA=e=>{if(e?.[Symbol.toStringTag]==="CryptoKey")return!0;try{return e instanceof CryptoKey}catch{return!1}},tE=e=>e?.[Symbol.toStringTag]==="KeyObject",tx=e=>tA(e)||tE(e),tk=e=>ty(e)&&"string"==typeof e.kty,tP=e=>e?.[Symbol.toStringTag],tR=(e,t,r)=>{if(void 0!==t.use){let e;switch(r){case"sign":case"verify":e="sig";break;case"encrypt":case"decrypt":e="enc"}if(t.use!==e)throw TypeError(`Invalid key for this operation, its "use" must be "${e}" when present`)}if(void 0!==t.alg&&t.alg!==e)throw TypeError(`Invalid key for this operation, its "alg" must be "${e}" when present`);if(Array.isArray(t.key_ops)){let s;switch(!0){case"sign"===r||"verify"===r:case"dir"===e:case e.includes("CBC-HS"):s=r;break;case e.startsWith("PBES2"):s="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(e):s=!e.includes("GCM")&&e.endsWith("KW")?"encrypt"===r?"wrapKey":"unwrapKey":r;break;case"encrypt"===r&&e.startsWith("RSA"):s="wrapKey";break;case"decrypt"===r:s=e.startsWith("RSA")?"unwrapKey":"deriveBits"}if(s&&t.key_ops?.includes?.(s)===!1)throw TypeError(`Invalid key for this operation, its "key_ops" must include "${s}" when present`)}return!0},t$=async(e,t,r,i=!1)=>{let n=(s||=new WeakMap).get(e);if(n?.[r])return n[r];let a=await tf({...t,alg:r});return i&&Object.freeze(e),n?n[r]=a:s.set(e,{[r]:a}),a};async function tI(e,t){if(e instanceof Uint8Array||tA(e))return e;if(tE(e)){if("secret"===e.type)return e.export();if("toCryptoKey"in e&&"function"==typeof e.toCryptoKey)try{return((e,t)=>{let r,i=(s||=new WeakMap).get(e);if(i?.[t])return i[t];let n="public"===e.type,a=!!n;if("x25519"===e.asymmetricKeyType){switch(t){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}r=e.toCryptoKey(e.asymmetricKeyType,a,n?[]:["deriveBits"])}if("ed25519"===e.asymmetricKeyType){if("EdDSA"!==t&&"Ed25519"!==t)throw TypeError("given KeyObject instance cannot be used for this algorithm");r=e.toCryptoKey(e.asymmetricKeyType,a,[n?"verify":"sign"])}switch(e.asymmetricKeyType){case"ml-dsa-44":case"ml-dsa-65":case"ml-dsa-87":if(t!==e.asymmetricKeyType.toUpperCase())throw TypeError("given KeyObject instance cannot be used for this algorithm");r=e.toCryptoKey(e.asymmetricKeyType,a,[n?"verify":"sign"])}if("rsa"===e.asymmetricKeyType){let s;switch(t){case"RSA-OAEP":s="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":s="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":s="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":s="SHA-512";break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}if(t.startsWith("RSA-OAEP"))return e.toCryptoKey({name:"RSA-OAEP",hash:s},a,n?["encrypt"]:["decrypt"]);r=e.toCryptoKey({name:t.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:s},a,[n?"verify":"sign"])}if("ec"===e.asymmetricKeyType){let s=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get(e.asymmetricKeyDetails?.namedCurve);if(!s)throw TypeError("given KeyObject instance cannot be used for this algorithm");"ES256"===t&&"P-256"===s&&(r=e.toCryptoKey({name:"ECDSA",namedCurve:s},a,[n?"verify":"sign"])),"ES384"===t&&"P-384"===s&&(r=e.toCryptoKey({name:"ECDSA",namedCurve:s},a,[n?"verify":"sign"])),"ES512"===t&&"P-521"===s&&(r=e.toCryptoKey({name:"ECDSA",namedCurve:s},a,[n?"verify":"sign"])),t.startsWith("ECDH-ES")&&(r=e.toCryptoKey({name:"ECDH",namedCurve:s},a,n?[]:["deriveBits"]))}if(!r)throw TypeError("given KeyObject instance cannot be used for this algorithm");return i?i[t]=r:s.set(e,{[t]:r}),r})(e,t)}catch(e){if(e instanceof TypeError)throw e}let r=e.export({format:"jwk"});return t$(e,r,t)}if(tk(e))return e.k?ti(e.k):t$(e,e,t,!0);throw Error("unreachable")}async function tT(e,t,r){let s,i;if(!ty(e))throw new tu("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new tu('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new tu("JWS Protected Header incorrect type");if(void 0===e.payload)throw new tu("JWS Payload missing");if("string"!=typeof e.signature)throw new tu("JWS Signature missing or incorrect type");if(void 0!==e.header&&!ty(e.header))throw new tu("JWS Unprotected Header incorrect type");let n={};if(e.protected)try{let t=ti(e.protected);n=JSON.parse(tr.decode(t))}catch{throw new tu("JWS Protected Header is invalid")}if(!function(...e){let t,r=e.filter(Boolean);if(0===r.length||1===r.length)return!0;for(let e of r){let r=Object.keys(e);if(!t||0===t.size){t=new Set(r);continue}for(let e of r){if(t.has(e))return!1;t.add(e)}}return!0}(n,e.header))throw new tu("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let a={...n,...e.header},o=function(e,t,r,s,i){let n;if(void 0!==i.crit&&s?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!s||void 0===s.crit)return new Set;if(!Array.isArray(s.crit)||0===s.crit.length||s.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let a of(n=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t,s.crit)){if(!n.has(a))throw new tl(`Extension Header Parameter "${a}" is not recognized`);if(void 0===i[a])throw new e(`Extension Header Parameter "${a}" is missing`);if(n.get(a)&&void 0===s[a])throw new e(`Extension Header Parameter "${a}" MUST be integrity protected`)}return new Set(s.crit)}(tu,new Map([["b64",!0]]),r?.crit,n,a),c=!0;if(o.has("b64")&&"boolean"!=typeof(c=n.b64))throw new tu('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:l}=a;if("string"!=typeof l||!l)throw new tu('JWS "alg" (Algorithm) Header Parameter missing or invalid');let u=r&&function(e,t){if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)}("algorithms",r.algorithms);if(u&&!u.has(l))throw new tc('"alg" (Algorithm) Header Parameter value not allowed');if(c){if("string"!=typeof e.payload)throw new tu("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new tu("JWS Payload must be a string or an Uint8Array instance");let h=!1;"function"==typeof t&&(t=await t(n,e),h=!0);var d=t,p="verify";switch(l.substring(0,2)){case"A1":case"A2":case"di":case"HS":case"PB":((e,t,r)=>{if(!(t instanceof Uint8Array)){if(tk(t)){if("oct"===t.kty&&"string"==typeof t.k&&tR(e,t,r))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!tx(t))throw TypeError(t_(e,t,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if("secret"!==t.type)throw TypeError(`${tP(t)} instances for symmetric algorithms must be of type "secret"`)}})(l,d,p);break;default:((e,t,r)=>{if(tk(t))switch(r){case"decrypt":case"sign":if("oct"!==t.kty&&("AKP"===t.kty&&"string"==typeof t.priv||"string"==typeof t.d)&&tR(e,t,r))return;throw TypeError("JSON Web Key for this operation must be a private JWK");case"encrypt":case"verify":if("oct"!==t.kty&&void 0===t.d&&void 0===t.priv&&tR(e,t,r))return;throw TypeError("JSON Web Key for this operation must be a public JWK")}if(!tx(t))throw TypeError(t_(e,t,"CryptoKey","KeyObject","JSON Web Key"));if("secret"===t.type)throw TypeError(`${tP(t)} instances for asymmetric algorithms must not be of type "secret"`);if("public"===t.type)switch(r){case"sign":throw TypeError(`${tP(t)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw TypeError(`${tP(t)} instances for asymmetric algorithm decryption must be of type "private"`)}if("private"===t.type)switch(r){case"verify":throw TypeError(`${tP(t)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw TypeError(`${tP(t)} instances for asymmetric algorithm encryption must be of type "public"`)}})(l,d,p)}let f=function(...e){let t=new Uint8Array(e.reduce((e,{length:t})=>e+t,0)),r=0;for(let s of e)t.set(s,r),r+=s.length;return t}(void 0!==e.protected?ts(e.protected):new Uint8Array,ts("."),"string"==typeof e.payload?c?ts(e.payload):tt.encode(e.payload):e.payload);try{s=ti(e.signature)}catch{throw new tu("Failed to base64url decode the signature")}let y=await tI(t,l);if(!await tS(l,y,s,f))throw new tp;if(c)try{i=ti(e.payload)}catch{throw new tu("Failed to base64url decode the payload")}else i="string"==typeof e.payload?tt.encode(e.payload):e.payload;let m={payload:i};return(void 0!==e.protected&&(m.protectedHeader=n),void 0!==e.header&&(m.unprotectedHeader=e.header),h)?{...m,key:y}:m}async function tC(e,t,r){if(e instanceof Uint8Array&&(e=tr.decode(e)),"string"!=typeof e)throw new tu("Compact JWS must be a string or Uint8Array");let{0:s,1:i,2:n,length:a}=e.split(".");if(3!==a)throw new tu("Invalid Compact JWS");let o=await tT({payload:i,protected:s,signature:n},t,r),c={payload:o.payload,protectedHeader:o.protectedHeader};return"function"==typeof t?{...c,key:o.key}:c}let tO=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;function tL(e){let t,r=tO.exec(e);if(!r||r[4]&&r[1])throw TypeError("Invalid time period format");let s=parseFloat(r[2]);switch(r[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":t=Math.round(s);break;case"minute":case"minutes":case"min":case"mins":case"m":t=Math.round(60*s);break;case"hour":case"hours":case"hr":case"hrs":case"h":t=Math.round(3600*s);break;case"day":case"days":case"d":t=Math.round(86400*s);break;case"week":case"weeks":case"w":t=Math.round(604800*s);break;default:t=Math.round(0x1e187e0*s)}return"-"===r[1]||"ago"===r[4]?-t:t}let tD=e=>e.includes("/")?e.toLowerCase():`application/${e.toLowerCase()}`;async function tK(e,t,r){let s=await tC(e,t,r);if(s.protectedHeader.crit?.includes("b64")&&!1===s.protectedHeader.b64)throw new th("JWTs MUST NOT use unencoded payload");let i={payload:function(e,t,r={}){var s,i;let n,a;try{n=JSON.parse(tr.decode(t))}catch{}if(!ty(n))throw new th("JWT Claims Set must be a top-level JSON object");let{typ:o}=r;if(o&&("string"!=typeof e.typ||tD(e.typ)!==tD(o)))throw new ta('unexpected "typ" JWT header value',n,"typ","check_failed");let{requiredClaims:c=[],issuer:l,subject:u,audience:h,maxTokenAge:d}=r,p=[...c];for(let e of(void 0!==d&&p.push("iat"),void 0!==h&&p.push("aud"),void 0!==u&&p.push("sub"),void 0!==l&&p.push("iss"),new Set(p.reverse())))if(!(e in n))throw new ta(`missing required "${e}" claim`,n,e,"missing");if(l&&!(Array.isArray(l)?l:[l]).includes(n.iss))throw new ta('unexpected "iss" claim value',n,"iss","check_failed");if(u&&n.sub!==u)throw new ta('unexpected "sub" claim value',n,"sub","check_failed");if(h&&(s=n.aud,i="string"==typeof h?[h]:h,"string"==typeof s?!i.includes(s):!(Array.isArray(s)&&i.some(Set.prototype.has.bind(new Set(s))))))throw new ta('unexpected "aud" claim value',n,"aud","check_failed");switch(typeof r.clockTolerance){case"string":a=tL(r.clockTolerance);break;case"number":a=r.clockTolerance;break;case"undefined":a=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:f}=r,y=Math.floor((f||new Date).getTime()/1e3);if((void 0!==n.iat||d)&&"number"!=typeof n.iat)throw new ta('"iat" claim must be a number',n,"iat","invalid");if(void 0!==n.nbf){if("number"!=typeof n.nbf)throw new ta('"nbf" claim must be a number',n,"nbf","invalid");if(n.nbf>y+a)throw new ta('"nbf" claim timestamp check failed',n,"nbf","check_failed")}if(void 0!==n.exp){if("number"!=typeof n.exp)throw new ta('"exp" claim must be a number',n,"exp","invalid");if(n.exp<=y-a)throw new to('"exp" claim timestamp check failed',n,"exp","check_failed")}if(d){let e=y-n.iat;if(e-a>("number"==typeof d?d:tL(d)))throw new to('"iat" claim timestamp check failed (too far in the past)',n,"iat","check_failed");if(e<0-a)throw new ta('"iat" claim timestamp check failed (it should be in the past)',n,"iat","check_failed")}return n}(s.protectedHeader,s.payload,r),protectedHeader:s.protectedHeader};return"function"==typeof t?{...i,key:s.key}:i}async function tW(e,t){try{var r;let s,i=(r={headerName:t?.headerName},s=r?.headerName??"x-whop-user-token","string"==typeof e?e:e instanceof Headers?e.get(s):e instanceof Request?e.headers.get(s):null);if(!i)throw Error("Whop user token not found. If you are the app developer, ensure you are developing in the whop.com iframe and have the dev proxy enabled.");let n=t.publicKey??'{"kty":"EC","x":"rz8a8vxvexHC0TLT91g7llOdDOsNuYiGEfic4Qhni-E","y":"zH0QblKYToexd5PEIMGXPVJS9AB5smKrW4S_TbiXrOs","crv":"P-256"}',a=await tm(JSON.parse(n),"ES256").catch(()=>{throw Error("Invalid public key provided to verifyUserToken")}),o=await tK(i,a,{issuer:"urn:whopcom:exp-proxy"}).catch(e=>{throw Error("Invalid user token provided to verifyUserToken")});if(!(o.payload.sub&&o.payload.aud)||Array.isArray(o.payload.aud))throw Error("Invalid user token provided to verifyUserToken");if(t.appId&&o.payload.aud!==t.appId)throw Error("Invalid app id provided to verifyUserToken");return{appId:o.payload.aud,userId:o.payload.sub}}catch(e){if(t.dontThrow)return null;throw e}}class tH{constructor({baseURL:e=te("WHOP_BASE_URL"),apiKey:t=te("WHOP_API_KEY"),webhookKey:r=te("WHOP_WEBHOOK_SECRET")??null,appID:s=te("WHOP_APP_ID")??null,...n}={}){if(e2.add(this),e5.set(this,void 0),this.verifyUserToken=function(e){return async function(t,r){if(!e.appID)throw Error("You must set appID in the Whop client constructor if you want to verify user tokens.");let s={appId:e.appID};return await tW(t,{...s,...r})}}(this),this.apps=new ed(this),this.invoices=new eI(this),this.courseLessonInteractions=new ew(this),this.products=new eM(this),this.companies=new em(this),this.webhooks=new e4(this),this.plans=new ej(this),this.entries=new eA(this),this.forumPosts=new eR(this),this.transfers=new eG(this),this.ledgerAccounts=new eC(this),this.memberships=new eL(this),this.authorizedUsers=new ep(this),this.appBuilds=new eh(this),this.shipments=new eV(this),this.checkoutConfigurations=new ey(this),this.messages=new eD(this),this.chatChannels=new ef(this),this.users=new eY(this),this.payments=new eH(this),this.supportChannels=new eX(this),this.experiences=new eE(this),this.reactions=new eJ(this),this.members=new eO(this),this.forums=new e$(this),this.promoCodes=new eN(this),this.courses=new ev(this),this.courseChapters=new eg(this),this.courseLessons=new eb(this),this.reviews=new eB(this),this.courseStudents=new e_(this),this.accessTokens=new ea(this),this.notifications=new eK(this),this.disputes=new eS(this),this.refunds=new eF(this),this.withdrawals=new e3(this),this.accountLinks=new eo(this),this.setupIntents=new eq(this),this.paymentMethods=new eW(this),this.feeMarkups=new ex(this),this.payoutMethods=new eU(this),this.verifications=new eQ(this),this.leads=new eT(this),this.topups=new ez(this),this.files=new eP(this),void 0===t)throw new c("The WHOP_API_KEY environment variable is missing or empty; either provide it, or instantiate the Whop client with an apiKey option, like new Whop({ apiKey: 'My API Key' }).");const a={apiKey:t,webhookKey:r,appID:s,...n,baseURL:e||"https://api.whop.com/api/v1"};this.baseURL=a.baseURL,this.timeout=a.timeout??e1.DEFAULT_TIMEOUT,this.logger=a.logger??console;const o="warn";this.logLevel=o,this.logLevel=N(a.logLevel,"ClientOptions.logLevel",this)??N(te("WHOP_LOG"),"process.env['WHOP_LOG']",this)??o,this.fetchOptions=a.fetchOptions,this.maxRetries=a.maxRetries??2,this.fetch=a.fetch??R(),i(this,e5,I,"f"),this._options=a,this.apiKey=t,this.webhookKey=r,this.appID=s}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,webhookKey:this.webhookKey,appID:this.appID,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return e7([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return function(e,t={}){let r,s=e,i=function(e=U){let t;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");let r=e.charset||U.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let s=T;if(void 0!==e.format){if(!L(O,e.format))throw TypeError("Unknown format option provided.");s=e.format}let i=O[s],n=U.filter;if(("function"==typeof e.filter||S(e.filter))&&(n=e.filter),t=e.arrayFormat&&e.arrayFormat in W?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":U.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let a=void 0===e.allowDots?!0==!!e.encodeDotInKeys||U.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:U.addQueryPrefix,allowDots:a,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:U.allowEmptyArrays,arrayFormat:t,charset:r,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:U.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?U.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:U.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:U.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:U.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:U.encodeValuesOnly,filter:n,format:s,formatter:i,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:U.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:U.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:U.strictNullHandling}}(t);"function"==typeof i.filter?s=(0,i.filter)("",s):S(i.filter)&&(r=i.filter);let n=[];if("object"!=typeof s||null===s)return"";let a=W[i.arrayFormat],o="comma"===a&&i.commaRoundTrip;r||(r=Object.keys(s)),i.sort&&r.sort(i.sort);let c=new WeakMap;for(let e=0;e<r.length;++e){let t=r[e];i.skipNulls&&null===s[t]||H(n,function e(t,r,s,i,n,a,o,c,l,u,h,d,p,f,y,m,g,w){var b,_;let v,A=t,E=w,x=0,k=!1;for(;void 0!==(E=E.get(j))&&!k;){let e=E.get(t);if(x+=1,void 0!==e)if(e===x)throw RangeError("Cyclic object value");else k=!0;void 0===E.get(j)&&(x=0)}if("function"==typeof u?A=u(r,A):A instanceof Date?A=p?.(A):"comma"===s&&S(A)&&(A=K(A,function(e){return e instanceof Date?p?.(e):e})),null===A){if(a)return l&&!m?l(r,U.encoder,g,"key",f):r;A=""}if("string"==typeof(b=A)||"number"==typeof b||"boolean"==typeof b||"symbol"==typeof b||"bigint"==typeof b||(_=A)&&"object"==typeof _&&_.constructor&&_.constructor.isBuffer&&_.constructor.isBuffer(_)){if(l){let e=m?r:l(r,U.encoder,g,"key",f);return[y?.(e)+"="+y?.(l(A,U.encoder,g,"value",f))]}return[y?.(r)+"="+y?.(String(A))]}let P=[];if(void 0===A)return P;if("comma"===s&&S(A))m&&l&&(A=K(A,l)),v=[{value:A.length>0?A.join(",")||null:void 0}];else if(S(u))v=u;else{let e=Object.keys(A);v=h?e.sort(h):e}let R=c?String(r).replace(/\./g,"%2E"):String(r),$=i&&S(A)&&1===A.length?R+"[]":R;if(n&&S(A)&&0===A.length)return $+"[]";for(let r=0;r<v.length;++r){let b=v[r],_="object"==typeof b&&void 0!==b.value?b.value:A[b];if(o&&null===_)continue;let E=d&&c?b.replace(/\./g,"%2E"):b,k=S(A)?"function"==typeof s?s($,E):$:$+(d?"."+E:"["+E+"]");w.set(t,x);let R=new WeakMap;R.set(j,w),H(P,e(_,k,s,i,n,a,o,c,"comma"===s&&m&&S(A)?null:l,u,h,d,p,f,y,m,g,R))}return P}(s[t],t,a,o,i.allowEmptyArrays,i.strictNullHandling,i.skipNulls,i.encodeDotInKeys,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,c))}let l=n.join(i.delimiter),u=!0===i.addQueryPrefix?"?":"";return i.charsetSentinel&&("iso-8859-1"===i.charset?u+="utf8=%26%2310003%3B&":u+="utf8=%E2%9C%93&"),l.length>0?u+l:""}(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${x}`}defaultIdempotencyKey(){return`stainless-node-retry-${a()}`}makeStatusError(e,t,r,s){return l.generate(e,t,r,s)}buildURL(e,t,r){let s=!n(this,e2,"m",e6).call(this)&&r||this.baseURL,i=new URL(v.test(e)?e:s+(s.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(a)&&(t={...a,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(i.search=this.stringifyQuery(t)),i.toString()}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(r=>({method:e,path:t,...r})))}request(e,t=null){return new G(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,r){let s=await e,i=s.maxRetries??this.maxRetries;null==t&&(t=i),await this.prepareOptions(s);let{req:n,url:a,timeout:c}=await this.buildRequest(s,{retryCount:i-t});await this.prepareRequest(n,{url:a,options:s});let l="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),p=void 0===r?"":`, retryOf: ${r}`,f=Date.now();if(V(this).debug(`[${l}] sending request`,X({retryOfRequestLogID:r,method:s.method,url:a,options:s,headers:n.headers})),s.signal?.aborted)throw new u;let y=new AbortController,m=await this.fetchWithTimeout(a,n,c,y).catch(o),g=Date.now();if(m instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(s.signal?.aborted)throw new u;let i="object"==typeof m&&null!==m&&("name"in m&&"AbortError"===m.name||"message"in m&&String(m.message).includes("FetchRequestCanceledException"))||/timed? ?out/i.test(String(m)+("cause"in m?String(m.cause):""));if(t)return V(this).info(`[${l}] connection ${i?"timed out":"failed"} - ${e}`),V(this).debug(`[${l}] connection ${i?"timed out":"failed"} (${e})`,X({retryOfRequestLogID:r,url:a,durationMs:g-f,message:m.message})),this.retryRequest(s,t,r??l);if(V(this).info(`[${l}] connection ${i?"timed out":"failed"} - error; no more retries left`),V(this).debug(`[${l}] connection ${i?"timed out":"failed"} (error; no more retries left)`,X({retryOfRequestLogID:r,url:a,durationMs:g-f,message:m.message})),i)throw new d;throw new h({cause:m})}let w=`[${l}${p}] ${n.method} ${a} ${m.ok?"succeeded":"failed"} with status ${m.status} in ${g-f}ms`;if(!m.ok){let e=await this.shouldRetry(m);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await $(m.body),V(this).info(`${w} - ${e}`),V(this).debug(`[${l}] response error (${e})`,X({retryOfRequestLogID:r,url:m.url,status:m.status,headers:m.headers,durationMs:g-f})),this.retryRequest(s,t,r??l,m.headers)}let i=e?"error; no more retries left":"error; not retryable";V(this).info(`${w} - ${i}`);let n=await m.text().catch(e=>o(e).message),a=(e=>{try{return JSON.parse(e)}catch(e){return}})(n),c=a?void 0:n;throw V(this).debug(`[${l}] response error (${i})`,X({retryOfRequestLogID:r,url:m.url,status:m.status,headers:m.headers,message:c,durationMs:Date.now()-f})),this.makeStatusError(m.status,a,c,m.headers)}return V(this).info(w),V(this).debug(`[${l}] response start`,X({retryOfRequestLogID:r,url:m.url,status:m.status,headers:m.headers,durationMs:g-f})),{response:m,options:s,controller:y,requestLogID:l,retryOfRequestLogID:r,startTime:f}}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}requestAPIList(e,t){return new Q(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,r,s){let{signal:i,method:n,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());let o=setTimeout(()=>s.abort(),r),c=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||"object"==typeof a.body&&null!==a.body&&Symbol.asyncIterator in a.body,l={signal:s.signal,...c?{duplex:"half"}:{},method:"GET",...a};n&&(l.method=n.toUpperCase());try{return await this.fetch.call(void 0,e,l)}finally{clearTimeout(o)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||!!(e.status>=500))}async retryRequest(e,t,r,s){let i,n=s?.get("retry-after-ms");if(n){let e=parseFloat(n);Number.isNaN(e)||(i=e)}let a=s?.get("retry-after");if(a&&!i){let e=parseFloat(a);i=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(i&&0<=i&&i<6e4)){let r=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(t,r)}return await E(i),this.makeRequest(e,t-1,r)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}async buildRequest(e,{retryCount:t=0}={}){let r={...e},{method:s,path:i,query:n,defaultBaseURL:a}=r,o=this.buildURL(i,n,a);"timeout"in r&&((e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new c(`${e} must be an integer`);if(t<0)throw new c(`${e} must be a positive integer`)})("timeout",r.timeout),r.timeout=r.timeout??this.timeout;let{bodyHeaders:l,body:u}=this.buildBody({options:r}),h=await this.buildHeaders({options:e,method:s,bodyHeaders:l,retryCount:t});return{req:{method:s,headers:h,...r.signal&&{signal:r.signal},...globalThis.ReadableStream&&u instanceof globalThis.ReadableStream&&{duplex:"half"},...u&&{body:u},...this.fetchOptions??{},...r.fetchOptions??{}},url:o,timeout:r.timeout}}async buildHeaders({options:e,method:r,bodyHeaders:s,retryCount:i}){let n={};this.idempotencyHeader&&"get"!==r&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),n[this.idempotencyHeader]=e.idempotencyKey);let a=e7([n,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...t??(t=(()=>{let e="u">typeof Deno&&null!=Deno.build?"deno":"u">typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":x,"X-Stainless-OS":P(Deno.build.os),"X-Stainless-Arch":k(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("u">typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":x,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":x,"X-Stainless-OS":P(globalThis.process.platform??"unknown"),"X-Stainless-Arch":k(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("u"<typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let r=t.exec(navigator.userAgent);if(r){let t=r[1]||0,s=r[2]||0,i=r[3]||0;return{browser:e,version:`${t}.${s}.${i}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":x,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":x,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),"X-Whop-App-Id":this.appID},await this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:t}}){var r;let s;if(!e)return{bodyHeaders:void 0,body:void 0};let i=e7([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&i.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:(s=Symbol.asyncIterator in(r=e)?r[Symbol.asyncIterator]():r[Symbol.iterator](),function(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}({start(){},async pull(e){let{done:t,value:r}=await s.next();t?e.close():e.enqueue(r)},async cancel(){await s.return?.()}}))}:n(this,e5,"f").call(this,{body:e,headers:i})}}if(e1=tH,e5=new WeakMap,e2=new WeakSet,e6=function(){return"https://api.whop.com/api/v1"!==this.baseURL},tH.Whop=e1,tH.DEFAULT_TIMEOUT=6e4,tH.WhopError=c,tH.APIError=l,tH.APIConnectionError=h,tH.APIConnectionTimeoutError=d,tH.APIUserAbortError=u,tH.NotFoundError=m,tH.ConflictError=g,tH.RateLimitError=b,tH.BadRequestError=p,tH.AuthenticationError=f,tH.InternalServerError=_,tH.PermissionDeniedError=y,tH.UnprocessableEntityError=w,tH.toFile=es,tH.Apps=ed,tH.Invoices=eI,tH.CourseLessonInteractions=ew,tH.Products=eM,tH.Companies=em,tH.Webhooks=e4,tH.Plans=ej,tH.Entries=eA,tH.ForumPosts=eR,tH.Transfers=eG,tH.LedgerAccounts=eC,tH.Memberships=eL,tH.AuthorizedUsers=ep,tH.AppBuilds=eh,tH.Shipments=eV,tH.CheckoutConfigurations=ey,tH.Messages=eD,tH.ChatChannels=ef,tH.Users=eY,tH.Payments=eH,tH.SupportChannels=eX,tH.Experiences=eE,tH.Reactions=eJ,tH.Members=eO,tH.Forums=e$,tH.PromoCodes=eN,tH.Courses=ev,tH.CourseChapters=eg,tH.CourseLessons=eb,tH.Reviews=eB,tH.CourseStudents=e_,tH.AccessTokens=ea,tH.Notifications=eK,tH.Disputes=eS,tH.Refunds=eF,tH.Withdrawals=e3,tH.AccountLinks=eo,tH.SetupIntents=eq,tH.PaymentMethods=eW,tH.FeeMarkups=ex,tH.PayoutMethods=eU,tH.Verifications=eQ,tH.Leads=eT,tH.Topups=ez,tH.Files=eP,!process.env.WHOP_API_KEY)throw Error("WHOP_API_KEY is not set");let tU=new tH({appID:"app_T5of943iJSW24E",apiKey:process.env.WHOP_API_KEY,webhookKey:btoa(process.env.WHOP_WEBHOOK_SECRET||"")}),tj=process.env.PLATFORM_COMPANY_ID;async function tM(e){if(!tj)throw Error("PLATFORM_COMPANY_ID is not set");let t=await tU.transfers.create({origin:tj,destination:e.recipientUserId,amount_cents:e.amountCents,currency:"usd",description:e.description,idempotency_key:e.idempotencyKey,metadata:e.metadata});return{transferId:t.id,status:t.status||"pending"}}async function tN(e){if(!tj)throw Error("PLATFORM_COMPANY_ID is not set");let t=await tU.checkoutConfigurations.create({plan:{company_id:tj,currency:e.currency,initial_price:e.amountCents/100,plan_type:"one_time",title:e.name,visibility:"hidden",product:{external_identifier:`waliet_hours_${Date.now()}`,title:e.name,business_type:"coaching"}},metadata:e.metadata,redirect_url:e.redirectUrl});if(!t||!t.plan)throw Error("Failed to create checkout configuration");return{id:t.id,planId:t.plan.id,purchaseUrl:t.purchase_url}}e.s(["PLATFORM_COMPANY_ID",0,tj,"createCheckoutConfig",()=>tN,"createPayoutTransfer",()=>tM,"whopsdk",0,tU],83974)}];

//# sourceMappingURL=waliet_fc052909._.js.map